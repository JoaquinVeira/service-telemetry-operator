template (name="rsyslog-record" type="list" option.jsonf="on")
{
    property(format="jsonf" dateFormat="rfc3339" name="timereported" outname="@timestamp" )
    property(format="jsonf" name="hostname" outname="host" )
    property(format="jsonf" name="syslogseverity" outname="severity" )
    property(format="jsonf" name="syslogfacility-text" outname="facility" )
    property(format="jsonf" name="syslogtag" outname="tag" )
    property(format="jsonf" name="app-name" outname="source" )
    property(format="jsonf" name="msg" outname="message" )
    property(format="jsonf" name="$!metadata!filename" outname="file")
    constant(format="jsonf" value="<<CLOUDNAME>>" outname="cloud")
    constant(format="jsonf" value="<region-name>" outname="region")
}

global(workDirectory="/var/lib/rsyslog")
module(load="builtin:omfile" Template="RSYSLOG_TraditionalFileFormat")

module(load="imfile" PollingInterval="1")
input(type="imfile"
  file="/tmp/test.log"
  tag="smoke.test"
)

module(load="omamqp1")
*.* action(type="omamqp1"
       host="amqp://default-interconnect.<<NAMESPACE>>.svc:5671"
       target="/rsyslog/logs"
       disableSASL="1"
       maxRetries="0"
       template="rsyslog-record")


